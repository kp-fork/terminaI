
> @google/gemini-cli-a2a-server@0.21.0-nightly.20251219.70696e364 test
> vitest run


 RUN  v3.2.4 /home/profharita/Code/termAI/packages/a2a-server
      Coverage enabled with v8

 âœ“ src/config/settings.test.ts (6 tests) 9ms
 âœ“ src/persistence/gcs.test.ts (12 tests) 24ms
 âœ“ src/commands/restore.test.ts (6 tests) 8ms
 âœ“ src/commands/extensions.test.ts (8 tests) 4ms
 âœ“ src/http/cors.test.ts (4 tests) 29ms
 âœ“ src/http/replay.test.ts (2 tests) 33ms
 âœ“ src/http/auth.test.ts (3 tests) 41ms
 âœ“ src/commands/init.test.ts (5 tests) 10ms
 âœ“ src/agent/task.test.ts (15 tests) 43ms
 â¯ src/http/endpoints.test.ts (5 tests | 3 failed) 53ms
   Ã— Agent Server Endpoints > should create a new task via POST /tasks 31ms
     â†’ expected 500 to be 201 // Object.is equality
   Ã— Agent Server Endpoints > should get metadata for a specific task via GET /tasks/:taskId/metadata 6ms
     â†’ expected 404 to be 200 // Object.is equality
   Ã— Agent Server Endpoints > should get metadata for all tasks via GET /tasks/metadata 3ms
     â†’ expected 204 to be 200 // Object.is equality
   âœ“ Agent Server Endpoints > should return 404 for a non-existent task 1ms
   âœ“ Agent Server Endpoints > should return agent metadata via GET /.well-known/agent-card.json 2ms
 â¯ src/http/app.test.ts (19 tests | 16 failed) 76ms
   Ã— E2E Tests > should create a new task and stream status updates (text-content) via POST / 25ms
     â†’ expected 200 "OK", got 500 "Internal Server Error"
   Ã— E2E Tests > should create a new task, schedule a tool call, and wait for approval 3ms
     â†’ expected 200 "OK", got 500 "Internal Server Error"
   Ã— E2E Tests > should handle multiple tool calls in a single turn 2ms
     â†’ expected 200 "OK", got 500 "Internal Server Error"
   Ã— E2E Tests > should handle multiple tool calls sequentially in YOLO mode 2ms
     â†’ expected 200 "OK", got 500 "Internal Server Error"
   Ã— E2E Tests > should handle tool calls that do not require approval 2ms
     â†’ expected 200 "OK", got 500 "Internal Server Error"
   Ã— E2E Tests > should bypass tool approval in YOLO mode 2ms
     â†’ expected 200 "OK", got 500 "Internal Server Error"
   Ã— E2E Tests > should include traceId in status updates when available 2ms
     â†’ expected 200 "OK", got 500 "Internal Server Error"
   âœ“ E2E Tests > /listCommands > should return a list of top-level commands 4ms
   âœ“ E2E Tests > /listCommands > should handle cyclic commands gracefully 7ms
   Ã— E2E Tests > /executeCommand > should return extensions for valid command 2ms
     â†’ expected 200 "OK", got 500 "Internal Server Error"
   Ã— E2E Tests > /executeCommand > should return 404 for invalid command 1ms
     â†’ expected 404 "Not Found", got 500 "Internal Server Error"
   Ã— E2E Tests > /executeCommand > should return 400 for missing command 1ms
     â†’ expected 400 "Bad Request", got 500 "Internal Server Error"
   Ã— E2E Tests > /executeCommand > should return 400 if args is not an array 1ms
     â†’ expected 400 "Bad Request", got 500 "Internal Server Error"
   Ã— E2E Tests > /executeCommand > should execute a command that does not require a workspace when CODER_AGENT_WORKSPACE_PATH is not set 3ms
     â†’ expected 500 to be 200 // Object.is equality
   Ã— E2E Tests > /executeCommand > should return 400 for a command that requires a workspace when CODER_AGENT_WORKSPACE_PATH is not set 1ms
     â†’ expected 500 to be 400 // Object.is equality
   Ã— E2E Tests > /executeCommand > should execute a command that requires a workspace when CODER_AGENT_WORKSPACE_PATH is set 1ms
     â†’ expected 500 to be 200 // Object.is equality
   Ã— E2E Tests > /executeCommand > should include agentExecutor in context 1ms
     â†’ expected 200 "OK", got 500 "Internal Server Error"
   âœ“ E2E Tests > /executeCommand > /executeCommand streaming > should execute a streaming command and stream back events 0ms
   Ã— E2E Tests > /executeCommand > /executeCommand streaming > should handle non-streaming commands gracefully 2ms
     â†’ expected 200 "OK", got 500 "Internal Server Error"
 âœ“ src/commands/command-registry.test.ts (6 tests) 2631ms
   âœ“ CommandRegistry > should register ExtensionsCommand on initialization  2014ms
   âœ“ CommandRegistry > should register sub commands on initialization  321ms

â¯â¯â¯â¯â¯â¯ Failed Tests 19 â¯â¯â¯â¯â¯â¯â¯

 FAIL  src/http/app.test.ts > E2E Tests > should create a new task and stream status updates (text-content) via POST /
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ src/http/app.test.ts:156:8
    154|       .set('Content-Type', 'application/json')
    155|       .send(body)
    156|       .expect(200);
       |        ^
    157| 
    158|     const events = streamToSSEEvents(res.text);
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/supertest/lib/test.js:138:14
 â¯ fn ../../node_modules/supertest/lib/test.js:156:7
 â¯ Test.callback ../../node_modules/superagent/src/node/index.js:904:3
 â¯ IncomingMessage.<anonymous> ../../node_modules/superagent/src/node/index.js:1183:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > should create a new task, schedule a tool call, and wait for approval
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ src/http/app.test.ts:223:8
    221|       .set('Content-Type', 'application/json')
    222|       .send(body)
    223|       .expect(200);
       |        ^
    224| 
    225|     const events = streamToSSEEvents(res.text);
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/supertest/lib/test.js:138:14
 â¯ fn ../../node_modules/supertest/lib/test.js:156:7
 â¯ Test.callback ../../node_modules/superagent/src/node/index.js:904:3
 â¯ IncomingMessage.<anonymous> ../../node_modules/superagent/src/node/index.js:1183:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > should handle multiple tool calls in a single turn
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ src/http/app.test.ts:330:8
    328|       .set('Content-Type', 'application/json')
    329|       .send(body)
    330|       .expect(200);
       |        ^
    331| 
    332|     const events = streamToSSEEvents(res.text);
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/supertest/lib/test.js:138:14
 â¯ fn ../../node_modules/supertest/lib/test.js:156:7
 â¯ Test.callback ../../node_modules/superagent/src/node/index.js:904:3
 â¯ IncomingMessage.<anonymous> ../../node_modules/superagent/src/node/index.js:1183:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > should handle multiple tool calls sequentially in YOLO mode
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ src/http/app.test.ts:489:8
    487|       .set('Content-Type', 'application/json')
    488|       .send(body)
    489|       .expect(200);
       |        ^
    490| 
    491|     const events = streamToSSEEvents(res.text);
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/supertest/lib/test.js:138:14
 â¯ fn ../../node_modules/supertest/lib/test.js:156:7
 â¯ Test.callback ../../node_modules/superagent/src/node/index.js:904:3
 â¯ IncomingMessage.<anonymous> ../../node_modules/superagent/src/node/index.js:1183:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > should handle tool calls that do not require approval
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ src/http/app.test.ts:611:8
    609|       .set('Content-Type', 'application/json')
    610|       .send(body)
    611|       .expect(200);
       |        ^
    612| 
    613|     const events = streamToSSEEvents(res.text);
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/supertest/lib/test.js:138:14
 â¯ fn ../../node_modules/supertest/lib/test.js:156:7
 â¯ Test.callback ../../node_modules/superagent/src/node/index.js:904:3
 â¯ IncomingMessage.<anonymous> ../../node_modules/superagent/src/node/index.js:1183:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > should bypass tool approval in YOLO mode
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ src/http/app.test.ts:742:8
    740|       .set('Content-Type', 'application/json')
    741|       .send(body)
    742|       .expect(200);
       |        ^
    743| 
    744|     const events = streamToSSEEvents(res.text);
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/supertest/lib/test.js:138:14
 â¯ fn ../../node_modules/supertest/lib/test.js:156:7
 â¯ Test.callback ../../node_modules/superagent/src/node/index.js:904:3
 â¯ IncomingMessage.<anonymous> ../../node_modules/superagent/src/node/index.js:1183:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > should include traceId in status updates when available
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ src/http/app.test.ts:842:8
    840|       .set('Content-Type', 'application/json')
    841|       .send(body)
    842|       .expect(200);
       |        ^
    843| 
    844|     const events = streamToSSEEvents(res.text);
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/supertest/lib/test.js:138:14
 â¯ fn ../../node_modules/supertest/lib/test.js:156:7
 â¯ Test.callback ../../node_modules/superagent/src/node/index.js:904:3
 â¯ IncomingMessage.<anonymous> ../../node_modules/superagent/src/node/index.js:1183:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > /executeCommand > should return extensions for valid command
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ src/http/app.test.ts:990:10
    988|         .set('Content-Type', 'application/json')
    989|         .send(body)
    990|         .expect(200);
       |          ^
    991| 
    992|       expect(res.body).toEqual({
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/supertest/lib/test.js:138:14
 â¯ fn ../../node_modules/supertest/lib/test.js:156:7
 â¯ Test.callback ../../node_modules/superagent/src/node/index.js:904:3
 â¯ IncomingMessage.<anonymous> ../../node_modules/superagent/src/node/index.js:1183:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > /executeCommand > should return 404 for invalid command
Error: expected 404 "Not Found", got 500 "Internal Server Error"
 â¯ src/http/app.test.ts:1009:10
    1007|         .set('Content-Type', 'application/json')
    1008|         .send(body)
    1009|         .expect(404);
       |          ^
    1010| 
    1011|       expect(res.body.error).toBe('Command not found: invalid command'â€¦
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/supertest/lib/test.js:138:14
 â¯ fn ../../node_modules/supertest/lib/test.js:156:7
 â¯ Test.callback ../../node_modules/superagent/src/node/index.js:904:3
 â¯ IncomingMessage.<anonymous> ../../node_modules/superagent/src/node/index.js:1183:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > /executeCommand > should return 400 for missing command
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 â¯ src/http/app.test.ts:1023:10
    1021|         .set('Content-Type', 'application/json')
    1022|         .send(body)
    1023|         .expect(400);
       |          ^
    1024|       expect(getExtensionsSpy).not.toHaveBeenCalled();
    1025|     });
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/supertest/lib/test.js:138:14
 â¯ fn ../../node_modules/supertest/lib/test.js:156:7
 â¯ Test.callback ../../node_modules/superagent/src/node/index.js:904:3
 â¯ IncomingMessage.<anonymous> ../../node_modules/superagent/src/node/index.js:1183:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > /executeCommand > should return 400 if args is not an array
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 â¯ src/http/app.test.ts:1035:10
    1033|         .set('Content-Type', 'application/json')
    1034|         .send(body)
    1035|         .expect(400);
       |          ^
    1036| 
    1037|       expect(res.body.error).toBe('"args" field must be an array.');
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/supertest/lib/test.js:138:14
 â¯ fn ../../node_modules/supertest/lib/test.js:156:7
 â¯ Test.callback ../../node_modules/superagent/src/node/index.js:904:3
 â¯ IncomingMessage.<anonymous> ../../node_modules/superagent/src/node/index.js:1183:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > /executeCommand > should execute a command that does not require a workspace when CODER_AGENT_WORKSPACE_PATH is not set
AssertionError: expected 500 to be 200 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

 â¯ src/http/app.test.ts:1059:31
    1057|         .send(body);
    1058| 
    1059|       expect(response.status).toBe(200);
       |                               ^
    1060|       expect(response.body.data).toBe('success');
    1061|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[12/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > /executeCommand > should return 400 for a command that requires a workspace when CODER_AGENT_WORKSPACE_PATH is not set
AssertionError: expected 500 to be 400 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 500[39m

 â¯ src/http/app.test.ts:1082:31
    1080|         .send(body);
    1081| 
    1082|       expect(response.status).toBe(400);
       |                               ^
    1083|       expect(response.body.error).toBe(
    1084|         'Command "workspace-command" requires a workspace, but CODER_Aâ€¦

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[13/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > /executeCommand > should execute a command that requires a workspace when CODER_AGENT_WORKSPACE_PATH is set
AssertionError: expected 500 to be 200 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

 â¯ src/http/app.test.ts:1107:31
    1105|         .send(body);
    1106| 
    1107|       expect(response.status).toBe(200);
       |                               ^
    1108|       expect(response.body.data).toBe('success');
    1109|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[14/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > /executeCommand > should include agentExecutor in context
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ src/http/app.test.ts:1131:10
    1129|         .set('Content-Type', 'application/json')
    1130|         .send(body)
    1131|         .expect(200);
       |          ^
    1132| 
    1133|       expect(res.body.data).toBe('success');
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/supertest/lib/test.js:138:14
 â¯ fn ../../node_modules/supertest/lib/test.js:156:7
 â¯ Test.callback ../../node_modules/superagent/src/node/index.js:904:3
 â¯ IncomingMessage.<anonymous> ../../node_modules/superagent/src/node/index.js:1183:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[15/19]â¯

 FAIL  src/http/app.test.ts > E2E Tests > /executeCommand > /executeCommand streaming > should handle non-streaming commands gracefully
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ src/http/app.test.ts:1224:12
    1222|           .set('Content-Type', 'application/json')
    1223|           .send(body)
    1224|           .expect(200);
       |            ^
    1225| 
    1226|         expect(res.body).toEqual({ name: 'non-stream-test', data: 'donâ€¦
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:309:14
 â¯ ../../node_modules/supertest/lib/test.js:365:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:342:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:195:23
 â¯ localAssert ../../node_modules/supertest/lib/test.js:138:14
 â¯ fn ../../node_modules/supertest/lib/test.js:156:7
 â¯ Test.callback ../../node_modules/superagent/src/node/index.js:904:3
 â¯ IncomingMessage.<anonymous> ../../node_modules/superagent/src/node/index.js:1183:18

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[16/19]â¯

 FAIL  src/http/endpoints.test.ts > Agent Server Endpoints > should create a new task via POST /tasks
AssertionError: expected 500 to be 201 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 500[39m

 â¯ src/http/endpoints.test.ts:138:29
    136|   it('should create a new task via POST /tasks', async () => {
    137|     const response = await createTask('test-context');
    138|     expect(response.status).toBe(201);
       |                             ^
    139|     expect(response.body).toBeTypeOf('string'); // Should return the tâ€¦
    140|   }, 7000);

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[17/19]â¯

 FAIL  src/http/endpoints.test.ts > Agent Server Endpoints > should get metadata for a specific task via GET /tasks/:taskId/metadata
AssertionError: expected 404 to be 200 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

 â¯ src/http/endpoints.test.ts:148:29
    146|       .get(`/tasks/${taskId}/metadata`)
    147|       .set(createAuthHeader());
    148|     expect(response.status).toBe(200);
       |                             ^
    149|     expect(response.body.metadata.id).toBe(taskId);
    150|   }, 6000);

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[18/19]â¯

 FAIL  src/http/endpoints.test.ts > Agent Server Endpoints > should get metadata for all tasks via GET /tasks/metadata
AssertionError: expected 204 to be 200 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 204[39m

 â¯ src/http/endpoints.test.ts:158:29
    156|       .get('/tasks/metadata')
    157|       .set(createAuthHeader());
    158|     expect(response.status).toBe(200);
       |                             ^
    159|     expect(Array.isArray(response.body)).toBe(true);
    160|     expect(response.body.length).toBeGreaterThan(0);

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[19/19]â¯


 Test Files  2 failed | 10 passed (12)
      Tests  19 failed | 72 passed (91)
   Start at  18:30:39
   Duration  3.17s (transform 1.29s, setup 0ms, collect 19.07s, tests 2.96s, environment 2ms, prepare 1.24s)

JUNIT report written to /home/profharita/Code/termAI/packages/a2a-server/junit.xml
npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path /home/profharita/Code/termAI/packages/a2a-server
npm error workspace @google/gemini-cli-a2a-server@0.21.0-nightly.20251219.70696e364
npm error location /home/profharita/Code/termAI/packages/a2a-server
npm error command failed
npm error command sh -c vitest run
